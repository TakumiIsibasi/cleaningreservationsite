{% extends 'basec.html' %}  <!-- 基本レイアウトテンプレート(basec.html)を継承 -->

{% block title %}
    清掃依頼詳細確認
{% endblock %}

{% block content %}
    <div class="container my-4">
        <h1 class="mb-4">清掃依頼詳細確認</h1>
        
        <!-- スケジュールデータを表示するテーブル -->
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">名前</th>
                        <th scope="col">清掃場所</th>
                        <th scope="col">清掃日時</th>
                        <th scope="col">依頼状態</th>
                    </tr>
                </thead>
                <tbody id="scheduleTableBody">
                    <!-- JavaScriptでデータをここに挿入 -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // APIからデータを取得して表示する関数
        function loadSchedules() {
            fetch('/api/schedule')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    const tableBody = document.getElementById('scheduleTableBody');
                    tableBody.innerHTML = '';  // テーブルの内容を初期化
                    data.forEach(item => {
                        // 通常のデータ行
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.name}</td>
                            <td>${item.location}</td>
                            <td>${item.date_time}</td>
                            <td>${item.status}</td>
                        `;
                        tableBody.appendChild(row);

                        // 備考欄の行 (もし備考があれば表示)
                        if (item.notes) {
                            const notesRow = document.createElement('tr');
                            notesRow.className = 'notes-row table-info';
                            notesRow.innerHTML = `
                                <td colspan="4"><strong>備考:</strong> ${item.notes}</td>
                            `;
                            tableBody.appendChild(notesRow);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    const tableBody = document.getElementById('scheduleTableBody');
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center text-danger">データの読み込み中にエラーが発生しました。</td>
                        </tr>
                    `;
                });
        }

        // ページロード時にスケジュールを読み込む
        window.onload = loadSchedules;
    </script>
{% endblock %}
